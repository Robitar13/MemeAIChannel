import requests
import os

def generate_meme_text():
    prompt = """
–ü—Ä–∏–¥—É–º–∞–π –æ—á–µ–Ω—å —Å–º–µ—à–Ω–æ–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ Telegram-–ø–æ—Å—Ç–∞.

1. –ü—Ä–∏–¥—É–º–∞–π –∫–æ—Ä–æ—Ç–∫—É—é, –∞–±—Å—É—Ä–¥–Ω—É—é –∏ –∂–∏–∑–Ω–µ–Ω–Ω—É—é —à—É—Ç–∫—É –≤ —Å—Ç–∏–ª–µ Reddit / –ü–∏–∫–∞–±—É
2. –ü—Ä–∏–¥—É–º–∞–π, –∫–∞–∫—É—é —Å—Ü–µ–Ω—É (—Å–∏—Ç—É–∞—Ü–∏—é/–ø–µ—Ä—Å–æ–Ω–∞–∂–∞) –Ω—É–∂–Ω–æ –∏–∑–æ–±—Ä–∞–∑–∏—Ç—å –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ, —á—Ç–æ–±—ã –æ–Ω–∞ –≤–∏–∑—É–∞–ª—å–Ω–æ –æ—Ç—Ä–∞–∂–∞–ª–∞ –º–µ–º


–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —à—É—Ç–∫–µ:
- –°–º–µ—à–Ω–æ, –Ω–µ–º–Ω–æ–≥–æ –∞–±—Å—É—Ä–¥–Ω–æ
- –ë–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π
- –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–ª–µ–Ω–≥, –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏
- 2‚Äì4 —Å—Ç—Ä–æ–∫–∏
- –ë–µ–∑ –ª–∏—à–Ω–µ–π "—É–º–Ω–æ—Å—Ç–∏"

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:

üñº –ö–∞—Ä—Ç–∏–Ω–∫–∞: [–æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å]
üìù –ú–µ–º-—Ç–µ–∫—Å—Ç: [—à—É—Ç–∫–∞]

–ü—Ä–∏–º–µ—Ä:

üñº –ö–∞—Ä—Ç–∏–Ω–∫–∞: –†–æ–±–æ—Ç –≤ –≥–∞–ª—Å—Ç—É–∫–µ –¥–µ—Ä–∂–∏—Ç –≤ —Ä—É–∫–∞—Ö –ª–∏—Å—Ç –±—É–º–∞–≥–∏ –∏ –ø–ª–∞—á–µ—Ç –ø–µ—Ä–µ–¥ –º–æ–Ω–∏—Ç–æ—Ä–æ–º
üìù –ú–µ–º-—Ç–µ–∫—Å—Ç: –ö–æ–≥–¥–∞ GPT –Ω–∞–ø–∏—Å–∞–ª –∫–æ–¥, –Ω–æ –∑–∞–±—ã–ª, –∑–∞—á–µ–º –æ–Ω —Ç–µ–±–µ –≤–æ–æ–±—â–µ
–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –Ω–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:
"""

    headers = {
        "Authorization": f"Bearer {os.getenv('OPENROUTER_API_KEY')}",
        "Content-Type": "application/json"
    }

    data = {
        "model": "openai/gpt-3.5-turbo",
        "messages": [{"role": "user", "content": prompt}]
    }

    r = requests.post("https://openrouter.ai/api/v1/chat/completions", headers=headers, json=data)
    text = r.json()['choices'][0]['message']['content']

    # –†–∞–∑–¥–µ–ª–∏–º –º–µ–º –∏ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã
    lines = text.strip().split("\n")
    meme_line = next((l for l in lines if l.startswith("üìù")), "üìù –ú–µ–º-—Ç–µ–∫—Å—Ç: (–º–µ–º –Ω–µ –Ω–∞–π–¥–µ–Ω)")
    image_line = next((l for l in lines if l.startswith("üñº")), "üñº –ö–∞—Ä—Ç–∏–Ω–∫–∞: (–æ–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω)")

    meme_text = meme_line.replace("üìù –ú–µ–º-—Ç–µ–∫—Å—Ç:", "").strip()
    image_prompt = image_line.replace("üñº –ö–∞—Ä—Ç–∏–Ω–∫–∞:", "").strip()

    return meme_text, image_prompt

